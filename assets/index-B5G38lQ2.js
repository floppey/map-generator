var F=e=>{throw TypeError(e)};var M=(e,t,s)=>t.has(e)||F("Cannot "+s);var a=(e,t,s)=>(M(e,t,"read from private field"),s?s.call(e):t.get(e)),d=(e,t,s)=>t.has(e)?F("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),g=(e,t,s,i)=>(M(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();class G{constructor(t,s,i,o){this.grid=t,this.x=s,this.y=i,this.options=o}collapse(){if(!this.collapsed)this.collapsed=this.options[Math.floor(Math.random()*this.options.length)];else throw console.log("Cell already collapsed",this),new Error("Cell already collapsed")}getNeighbors(){return{top:this.grid.cells.find(t=>t.x===this.x&&t.y===this.y-1),right:this.grid.cells.find(t=>t.x===this.x+1&&t.y===this.y),bottom:this.grid.cells.find(t=>t.x===this.x&&t.y===this.y+1),left:this.grid.cells.find(t=>t.x===this.x-1&&t.y===this.y)}}evaluate(){var s,i,o,l;if(this.collapsed)return;const t=this.getNeighbors();(s=t.top)!=null&&s.collapsed&&(this.options=this.options.filter(r=>{var n,c;return r.sockets.top===((c=(n=t.top)==null?void 0:n.collapsed)==null?void 0:c.sockets.bottom)})),(i=t.right)!=null&&i.collapsed&&(this.options=this.options.filter(r=>{var n,c;return r.sockets.right===((c=(n=t.right)==null?void 0:n.collapsed)==null?void 0:c.sockets.left)})),(o=t.bottom)!=null&&o.collapsed&&(this.options=this.options.filter(r=>{var n,c;return r.sockets.bottom===((c=(n=t.bottom)==null?void 0:n.collapsed)==null?void 0:c.sockets.top)})),(l=t.left)!=null&&l.collapsed&&(this.options=this.options.filter(r=>{var n,c;return r.sockets.left===((c=(n=t.left)==null?void 0:n.collapsed)==null?void 0:c.sockets.right)}))}}var b,m;class D{constructor(t,s){d(this,b);d(this,m);g(this,b,s),g(this,m,[]);for(let i=0;i<t;i++)for(let o=0;o<t;o++)a(this,m).push(new G(this,i,o,[...s]))}get tiles(){return a(this,b)}get cells(){return a(this,m)}collapseNextCell(){const t=this.cells.filter(o=>!o.collapsed).sort((o,l)=>o.options.length-l.options.length),s=t.filter(o=>o.options.length===t[0].options.length);s[Math.floor(Math.random()*s.length)].collapse()}evaluate(){this.cells.forEach(t=>{t.evaluate()})}}b=new WeakMap,m=new WeakMap;var w,x,E,k;class f{constructor(t,s,i=0,o=null){d(this,w);d(this,x);d(this,E);d(this,k);g(this,x,t),g(this,w,s),g(this,E,i),g(this,k,o)}get sockets(){return a(this,w)}get image(){return a(this,x)}get rotation(){return a(this,E)}get flipDirection(){return a(this,k)}}w=new WeakMap,x=new WeakMap,E=new WeakMap,k=new WeakMap;const I=e=>{const{top:t,right:s,bottom:i,left:o}=e.sockets,{rotation:l,image:r,flipDirection:n}=e;return new f(r,{top:o,right:t,bottom:s,left:i},(l+90)%360,n)},A=[new f("0.png",{top:"AAA",right:"AAA",bottom:"AAA",left:"AAA"}),new f("1.png",{top:"ABA",right:"AAA",bottom:"ABA",left:"AAA"}),new f("2.png",{top:"ABA",right:"ABA",bottom:"ABA",left:"ABA"}),new f("3.png",{top:"ABA",right:"ABA",bottom:"AAA",left:"ABA"}),new f("4.png",{top:"ABA",right:"AAA",bottom:"AAA",left:"ABA"})],R=[];for(let e=0;e<A.length;e++){const t=I(A[e]),s=I(t),i=I(s);R.push(t,s,i)}const K=[];A.push(...R,...K);const B=[];A.forEach(e=>{B.some(t=>t.image===e.image&&t.sockets.top===e.sockets.top&&t.sockets.right===e.sockets.right&&t.sockets.bottom===e.sockets.bottom&&t.sockets.left===e.sockets.left)||B.push(e)});const v=20,u=1e3,h=u/v,L=document.getElementById("map"),p=L.getContext("2d");if(!p)throw new Error("Could not get canvas context");L.height=u;L.width=u;let y=new D(v,B),C=-1;const T={};A.forEach(e=>{const t=new Image;t.src=`./simple/${e.image}`,T[e.image]=t});const N=()=>{p.clearRect(0,0,u,u),y.cells.forEach(e=>{var i;const t=e.x*h,s=e.y*h;if(e.collapsed){const o=T[e.collapsed.image];(i=e.collapsed)!=null&&i.rotation?(p.save(),p.translate(t+h/2,s+h/2),p.rotate(e.collapsed.rotation*Math.PI/180),p.drawImage(o,-50/2,-50/2,h,h),p.restore()):p.drawImage(o,t,s,h,h)}})},Z=()=>{y.collapseNextCell(),y.evaluate()},_=()=>{if(!y.cells.some(e=>!e.collapsed)){console.log("All cells collapsed"),cancelAnimationFrame(C);return}Z(),N(),C=requestAnimationFrame(_)};var O;(O=document.getElementById("collapseNext"))==null||O.addEventListener("click",()=>{Z(),N()});var P;(P=document.getElementById("collapseAll"))==null||P.addEventListener("click",()=>{cancelAnimationFrame(C),_()});var S;(S=document.getElementById("reset"))==null||S.addEventListener("click",()=>{cancelAnimationFrame(C),y=new D(v,B),N()});
